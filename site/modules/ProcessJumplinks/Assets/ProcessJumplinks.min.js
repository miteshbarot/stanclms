/**--
 * Jumplinks for ProcessWire
 * Manage permanent and temporary redirects. Uses named wildcards and mapping collections.
 *
 * Process module for ProcessWire 2.6.1+
 *
 * @author Mike Rockett
 * @copyright (c) 2015, Mike Rockett. All Rights Reserved.
 * @license ISC
 *
 * @see Documentation:     https://jumplinks.rockett.pw
 * @see Modules Directory: https://mods.pw/92
 * @see Forum Thred:       https://processwire.com/talk/topic/8697-jumplinks/
 * @see Donate:            https://rockett.pw/donate
 */
$(function(){"use strict";var t=$("form#pjTabs"),e=function(t){var e="";t.map(function(t){e+='<li style="padding: 9px 24px; border-bottom: 1px solid #ececec">'+t+"</li>"}),$("body").css("overflow","hidden"),$('<div id="validationMessage"></div>').html("<ol>"+e+"</ol>").appendTo("body").dialog({draggable:!1,modal:!0,position:["middle",125],resizable:!1,title:"Errors",width:550,buttons:{Close:function(){$(this).dialog("close")}},close:function(){$(this).dialog("destroy").remove(),$("body").css("overflow","auto")}})};config.pjAdmin&&function(){t.find("script").remove(),t.WireTabs({items:$("#pjTabs > .Inputfields > .InputfieldWrapper"),id:"ProcessJumplinksTabs",rememberTabs:!0,skipRememberTabIDs:["log","import"]});var e=$(".AdminDataTable.jumplinks td > span#staleJumplink",t),a=e.parent().parent();a.find("td").css("background-color","#fff3f3"),a.find("td:first > a").css("color","#db4747")}(),config.pjEntity&&function(){$("#destinationPage").on("pageSelected",function(t,e){e.id>0&&($("input#destinationUriUrl").val("page:"+e.id),$("#destinationPageAuto").val(e.id),$("#destinationPageAuto_input").attr("data-selectedlabel",e.title).val(e.title))}),$("#destinationPageAuto").on("change",function(t){t.currentTarget.value&&($("input#destinationUriUrl").val("page:"+t.currentTarget.value),$("#destinationPage").val(t.currentTarget.value).parent().find(".label_title, .PageListSelectName").text($("#destinationPageAuto_input").attr("data-selectedlabel")))}),$("button#saveJumplink").on("click",function(){var t={sourcePath:$("input#sourcePath").val(),destinationUriUrl:$("input#destinationUriUrl").val(),dateStart:$("#dateStart").val(),dateEnd:$("#dateEnd").val()},a=[];if(0===t.sourcePath.trim().length)a.push("Source can't be empty...");else{var n=new RegExp("^(?:[a-z]+:)?//","i");n.test(t.sourcePath)&&a.push("Source cannot be an absolute URL. It needs to be relative to the root of your installation, without the leading forward-slash.")}return 0===t.destinationUriUrl.trim().length&&a.push("You need to select a Destination..."),t.dateStart&&t.dateEnd&&new Date(t.dateStart).getTime()>=new Date(t.dateEnd).getTime()&&a.push("End Date/Time cannot occur on or before Start Date/Time."),a.length?(e(a),!1):void 0})}(),config.pjCollection&&function(){$("button#installMappingCollection").on("click",function(){var t={name:$("input#collectionName").val(),data:$("textarea#collectionData").val()},a=[];return t.name?t.name.trim().length<3&&a.push("Collection Name should be at least 3 characters"):a.push("Collection Name can't be empty..."),t.data?t.data.trim().length<6&&a.push("Collection Data should be at least 6 characters"):a.push("Collection Data can't be empty..."),a.length?(e(a),!1):void 0})}(),config.pjImport&&function(){$("button#doImport").on("click",function(){var t={data:$("textarea#csvData").val()},a=[];return config.pjImportCSVData&&(t.data||a.push("CSV data can't be empty...")),a.length?(e(a),!1):void 0})}(),config.pjModuleAdmin&&function(){var t="InputfieldTask",e={statusCodes:"200 301 302"};$("a[href=#resetLegacyStatusCodes]").removeAttr("target").addClass(t).on("click",function(t){$("input#statusCodes").val(e.statusCodes),t.preventDefault()});var a=function(t,e,a){a="undefined"!=typeof a?a:"";var n=$("<button/>").attr("id",t).addClass("ui-button ui-widget ui-state-default ui-priority-secondary").on("click",function(t){t.preventDefault(),window.location=config.pjAdminPageUrl+a}).appendTo(".Inputfield_submit_save_module .InputfieldContent");$("<span/>").addClass("ui-button-text").text(e).appendTo(n)};a("ButtonManageRJumplinks","Manage Jumplinks"),a("ButtonImportCSV","Import from CSV","import/?type=csv"),config.pjOldRedirectsInstalled&&a("ButtonImportRedirectsModule","Import from Redirects module","import/?type=redirects")}()});
